// Fastclick - disable click delay
new FastClick(document.body);document.ontouchmove=function(e){e.preventDefault()};App=Ember.Application.create();App.Router.map(function(){this.route("intro");this.route("pre");this.route("test");this.route("result")});App.IndexRoute=Em.Route.extend({redirect:function(){this.transitionTo("intro")}});App.IntroRoute=Em.Route.extend({model:function(){return this.store.find("corsi",1)}});App.PreRoute=Em.Route.extend({model:function(){return this.store.find("corsi",1)}});App.TestRoute=Em.Route.extend({model:function(){return this.store.find("corsi",1)}});App.ResultRoute=Em.Route.extend({model:function(){return this.store.find("corsi",1)}});App.IntroView=Em.View.extend({didInsertElement:function(){var e=this.get("controller");e.setProperties({level:1,clicks:0,tapErrors:0,errCount:0})},touchEnd:function(e){e.target.nodeName==="BUTTON"&&this.get("controller").transitionToRoute("pre")},click:function(e){e.target.nodeName==="BUTTON"&&this.get("controller").transitionToRoute("pre")}});App.PreView=Em.View.extend({didInsertElement:function(){var e=this.get("controller.level"),t=1;while(e>=t){this.$("#small-btn-"+t).addClass("btn-flash");t+=1}},willDestroyElement:function(){this.$(".small-btns").find(".btn").removeClass("btn-flash")},touchEnd:function(e){e.target.nodeName==="BUTTON"&&this.get("controller").transitionToRoute("test")},click:function(e){e.target.nodeName==="BUTTON"&&this.get("controller").transitionToRoute("test")}});App.ResultView=Em.View.extend({didInsertElement:function(){this.set("controller.level",this.get("controller.level")-1)},touchEnd:function(e){e.target.nodeName==="BUTTON"&&this.get("controller").transitionToRoute("intro")},click:function(e){e.target.nodeName==="BUTTON"&&this.get("controller").transitionToRoute("intro")}});App.TestView=Em.View.extend({previousTouchId:0,willDestroyElement:function(){var e=this.get("controller");e.setProperties({clicks:0,tapErrors:0});this.set("previousTouchId",0);this.$(".test-btns").toggleClass("animation play");this.$(".btn").removeClass("btn-flash-show btn-flash btn-danger");this.$(".message").empty()},didInsertElement:function(){this.setElements()},setElements:function(){var e=this,t=_.shuffle(_.first(_.shuffle(randomGrids)));e.$(".test-btns").addClass("animation");e.$(".screen").removeClass("hidden");t.forEach(function(t,n){e.$("#btn-"+(n+1)).css({left:t.left,top:t.top,visibility:"visible"})});Ember.run.next(function(){setTimeout(function(){e.flashElements()},500)})},flashElements:function(){var e=this.get("controller").get("level"),t=1,n=this;$(".message").html("<strong>Odota</strong> ja <strong>seuraa</strong> mitkä neliöt välähtävät.");var r=setInterval(function(){var i=n.$("#btn-"+t);i.addClass("btn-flash");setTimeout(function(){i.removeClass("btn-flash")},1300);if(t>=e){clearInterval(r);setTimeout(function(){n.$(".test-btns").toggleClass("animation play");n.$(".screen").addClass("hidden");$(".message").html("<strong>Kosketa</strong> välähtäneitä neliöitä samassa järjestyksessä.")},2e3)}t+=1},2500)},touchEnd:function(e){this.eventChannel(e)},click:function(e){this.eventChannel(e)},eventChannel:function(e){var t=$(e.target),n=this.get("controller"),r=t.text();if(e.target.nodeName!="BUTTON"||n.get("clicks")+1>n.get("level"))return!1;if(r==this.get("previousTouchId"))return!1;this.set("previousTouchId",r);n.set("clicks",n.get("clicks")+1);this.testEvent(r)},testEvent:function(e){var t=this,n=1,r=t.get("controller"),i=r.get("clicks"),s=r.get("level"),o=r.get("tapErrors"),u=r.get("errCount");if(i!=e){r.set("tapErrors",o+1);t.$("#btn-"+i).addClass("error")}if(i>=s){n=1;while(s>=n){t.$("#btn-"+n).addClass("btn-flash-show");n+=1}t.$(".error").toggleClass("error btn-danger");r.get("tapErrors")===0?$(".message").html("Vastasit tehtävään <strong>oikein</strong>."):r.get("errCount")===0?$(".message").html("Vastasit tehtävään <strong>väärin</strong>. Yritä uudelleen."):$(".message").html("Vastasit tehtävään <strong>väärin</strong>. Testi päättyy.");setTimeout(function(){if(r.get("tapErrors")===0){r.set("errCount",0);r.set("level",s+1)}else{u+=1;r.set("errCount",u)}u>1||r.get("level")>=10?r.transitionToRoute("result"):r.transitionToRoute("pre")},4e3)}}});Em.Handlebars.registerBoundHelper("multiply",function(e,t){return e>1?t+"ta":t});App.ApplicationAdapter=DS.FixtureAdapter;App.Corsi=DS.Model.extend({level:DS.attr("number"),clicks:DS.attr("number"),tapErrors:DS.attr("number"),errCount:DS.attr("number")});App.Corsi.FIXTURES=[{id:1,level:1,clicks:0,tapErrors:0,errCount:0}];var randomGrids=[[{top:68,left:43},{top:391,left:298},{top:32,left:299},{top:19,left:628},{top:188,left:562},{top:360,left:56},{top:214,left:211},{top:227,left:389},{top:370,left:614}],[{top:28,left:378},{top:259,left:228},{top:40,left:129},{top:68,left:570},{top:376,left:449},{top:360,left:56},{top:201,left:56},{top:199,left:395},{top:251,left:618}],[{top:30,left:323},{top:212,left:200},{top:24,left:75},{top:35,left:599},{top:333,left:381},{top:360,left:56},{top:372,left:530},{top:174,left:414},{top:224,left:597}],[{top:20,left:406},{top:190,left:238},{top:24,left:75},{top:32,left:632},{top:335,left:261},{top:360,left:56},{top:380,left:470},{top:166,left:447},{top:234,left:592}],[{top:182,left:173},{top:24,left:224},{top:24,left:75},{top:394,left:123},{top:335,left:261},{top:26,left:447},{top:374,left:499},{top:166,left:447},{top:234,left:592}],[{top:160,left:211},{top:27,left:383},{top:24,left:75},{top:394,left:123},{top:306,left:312},{top:91,left:591},{top:374,left:499},{top:167,left:452},{top:234,left:592}],[{top:179,left:202},{top:14,left:347},{top:27,left:642},{top:382,left:137},{top:329,left:282},{top:245,left:61},{top:381,left:499},{top:156,left:453},{top:240,left:595}],[{top:160,left:293},{top:16,left:165},{top:390,left:648},{top:382,left:137},{top:329,left:282},{top:166,left:80},{top:349,left:472},{top:113,left:453},{top:226,left:618}],[{top:106,left:201},{top:22,left:381},{top:381,left:620},{top:404,left:405},{top:344,left:219},{top:157,left:42},{top:397,left:33},{top:30,left:615},{top:195,left:532}],[{top:102,left:204},{top:250,left:218},{top:381,left:620},{top:204,left:501},{top:209,left:359},{top:22,left:384},{top:362,left:386},{top:30,left:615},{top:195,left:32}],[{top:85,left:217},{top:372,left:91},{top:313,left:615},{top:182,left:35},{top:230,left:255},{top:22,left:384},{top:391,left:367},{top:102,left:599},{top:207,left:443}],[{top:50,left:231},{top:397,left:248},{top:352,left:614},{top:27,left:45},{top:328,left:82},{top:22,left:384},{top:388,left:441},{top:137,left:545},{top:207,left:391}],[{top:50,left:231},{top:397,left:248},{top:352,left:614},{top:52,left:66},{top:328,left:82},{top:232,left:250},{top:347,left:440},{top:188,left:535},{top:43,left:636}],[{top:151,left:217},{top:377,left:257},{top:42,left:394},{top:377,left:631},{top:309,left:81},{top:191,left:374},{top:347,left:440},{top:188,left:535},{top:43,left:636}],[{top:46,left:63},{top:352,left:105},{top:23,left:474},{top:354,left:624},{top:201,left:129},{top:176,left:323},{top:329,left:281},{top:188,left:497},{top:66,left:652}]];